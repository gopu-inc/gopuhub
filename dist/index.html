<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>gopHub Frontend</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Custom CSS -->
  <style>
    body {
      background: #0b0f14;
      color: #e6e6e6;
      font-family: sans-serif;
    }
    nav button {
      transition: all 0.2s ease;
      padding: 0.8rem 1.4rem; /* ‚úÖ boutons plus grands */
      font-size: 1rem;
    }
    nav button:hover {
      color: #e46b10;
      transform: scale(1.05);
    }
    .card {
      background: #11161d;
      border: 1px solid #e46b10;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
    footer {
      text-align: center;
      padding: 1rem;
      border-top: 1px solid #e46b10;
      margin-top: 2rem;
      color: #888;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Navigation -->
  <nav class="flex items-center justify-between p-4 border-b border-[#e46b10]">
    <div class="flex gap-4">
      <span class="font-bold text-[#e46b10]">gopHub üê®üî•‚ö°Ô∏è</span>
      <button onclick="showPage('dashboard')">Dashboard</button>
      <button onclick="showPage('packages')">Packages</button>
      <button onclick="showPage('upload')">Upload</button>
      <button onclick="showPage('markdown')">Markdown</button>
    </div>
    <div id="authNav" class="flex gap-4"></div>
  </nav>

  <!-- Main content -->
  <main class="flex-grow max-w-3xl mx-auto p-6 space-y-6">
    <!-- Dashboard -->
    <section id="dashboard" class="hidden card">
      <h1 class="text-2xl font-semibold">Dashboard</h1>
      <p id="status"></p>
    </section>

    <!-- Register -->
    <section id="register" class="hidden card">
      <h1 class="text-xl">Register</h1>
      <input id="regEmail" class="w-full p-2 bg-black border mb-2" placeholder="email">
      <input id="regPass" type="password" class="w-full p-2 bg-black border mb-2" placeholder="password">
      <button class="px-6 py-3 border border-[#e46b10]" onclick="register()">Register</button>
      <p id="regMsg" class="text-[#e46b10] mt-2"></p>
    </section>

    <!-- Login -->
    <section id="login" class="hidden card">
      <h1 class="text-xl">Login</h1>
      <input id="logEmail" class="w-full p-2 bg-black border mb-2" placeholder="email">
      <input id="logPass" type="password" class="w-full p-2 bg-black border mb-2" placeholder="password">
      <button class="px-6 py-3 border border-[#e46b10]" onclick="login()">Login</button>
      <p id="loginMsg" class="text-[#e46b10] mt-2"></p>
    </section>

    <!-- Upload -->
    <section id="upload" class="hidden card">
      <h1 class="text-xl">Upload Package</h1>
      <input id="pkgName" class="w-full p-2 bg-black border mb-2" placeholder="package name">
      <input id="pkgFile" type="file" class="w-full p-2 bg-black border mb-2">
      <button class="px-6 py-3 border border-[#e46b10]" onclick="push()">Push</button>
      <p id="pushMsg" class="text-[#e46b10] mt-2"></p>
    </section>

    <!-- Packages -->
    <section id="packages" class="hidden card">
      <h1 class="text-xl">Packages</h1>
      <button class="px-6 py-3 border border-[#e46b10]" onclick="list()">Refresh</button>
      <ul id="pkgList" class="space-y-2 mt-2"></ul>
    </section>

    <!-- Markdown Page -->
    <section id="markdown" class="hidden card">
      <h1 class="text-xl">Markdown Viewer</h1>
      <textarea id="mdInput" class="w-full p-2 bg-black border mb-2" rows="6" placeholder="√âcris ton markdown ici..."></textarea>
      <button class="px-6 py-3 border border-[#e46b10]" onclick="renderMarkdown()">Render</button>
      <div id="mdOutput" class="prose prose-invert mt-4"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    gopu.inc. ¬© 2025
  </footer>

<script>
const API = "https://gophub.onrender.com";
let token = localStorage.getItem("token") || null;
let email = localStorage.getItem("email") || null;

function showPage(id) {
  document.querySelectorAll("section").forEach(s => s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function updateNav() {
  const nav = document.getElementById("authNav");
  nav.innerHTML = token
    ? `<span class="text-[#e46b10]">${email}</span>
       <button class="px-6 py-3 border border-[#e46b10]" onclick="logout()">Logout</button>`
    : `<button class="px-6 py-3 border border-[#e46b10]" onclick="showPage('login')">Login</button>
       <button class="px-6 py-3 border border-[#e46b10]" onclick="showPage('register')">Register</button>`;
}

async function register() {
  email = document.getElementById("regEmail").value;
  const password = document.getElementById("regPass").value;
  const res = await fetch(API+"/register", {
    method:"POST", headers:{"Content-Type":"application/json"},
    body: JSON.stringify({email,password})
  });
  const data = await res.json();
  document.getElementById("regMsg").innerText = JSON.stringify(data);
  showPage("login");
}

async function login() {
  email = document.getElementById("logEmail").value;
  const password = document.getElementById("logPass").value;
  const res = await fetch(API+"/login", {
    method:"POST", headers:{"Content-Type":"application/json"},
    body: JSON.stringify({email,password})
  });
  const data = await res.json();
  if(data.token){
    token=data.token;
    localStorage.setItem("token", token);
    localStorage.setItem("email", email);
    updateNav();
    document.getElementById("status").innerText = `Bienvenue ${email} üê®üî•‚ö°Ô∏è`;
    showPage("dashboard");
  }
  document.getElementById("loginMsg").innerText = JSON.stringify(data);
}

async function push() {
  const name = document.getElementById("pkgName").value;
  const file = document.getElementById("pkgFile").files[0];
  const fd = new FormData();
  fd.append("name", name);
  fd.append("file", file);
  const res = await fetch(API+"/push", {
    method:"POST", headers:{Authorization:`Bearer ${token}`}, body:fd
  });
  const data = await res.json();
  document.getElementById("pushMsg").innerText = JSON.stringify(data);
}

async function list() {
  const res = await fetch(API+"/list");
  const data = await res.json();
  const ul = document.getElementById("pkgList");
  ul.innerHTML = "";
  data.packages.forEach(p=>{
    ul.innerHTML += `<li class="flex gap-2">${p}
      <button class="px-4 py-2 border border-[#e46b10]" onclick="pull('${p}')">Pull</button>
      <button class="px-4 py-2 border border-[#e46b10]" onclick="del('${p}')">Delete</button>
    </li>`;
  });
}
async function pull(name) {
  const res = await fetch(API+"/pull/"+name);
  if(res.ok){
    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = name+".pkg";
    a.click();
    URL.revokeObjectURL(url);
  } else {
    alert("Erreur lors du t√©l√©chargement: " + res.statusText);
  }
}

async function del(name) {
  const res = await fetch(API+"/delete/"+name, {
    method:"DELETE",
    headers:{Authorization:`Bearer ${token}`}
  });
  const data = await res.json();
  alert(JSON.stringify(data));
  list();
}

function renderMarkdown() {
  const input = document.getElementById("mdInput").value;
  const output = document.getElementById("mdOutput");
  output.innerHTML = marked.parse(input);
}

function logout(){
  token=null; email=null;
  localStorage.removeItem("token");
  localStorage.removeItem("email");
  updateNav();
  showPage("login");
}

// Initialisation
updateNav();
showPage("dashboard");
</script>

